import { of, pipe } from 'rxjs';
import { concatMap, withLatestFrom } from 'rxjs/operators';
/**
 * 'concatLatestFrom' combines the source value
 * and the last available value from a lazily evaluated Observable
 * in a new array
 */
export function concatLatestFrom(observablesFactory) {
    return pipe(concatMap((value) => {
        const observables = observablesFactory(value);
        const observablesAsArray = Array.isArray(observables)
            ? observables
            : [observables];
        return of(value).pipe(withLatestFrom(...observablesAsArray));
    }));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uY2F0X2xhdGVzdF9mcm9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbW9kdWxlcy9lZmZlY3RzL3NyYy9jb25jYXRfbGF0ZXN0X2Zyb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUErQixFQUFFLEVBQW9CLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvRSxPQUFPLEVBQUUsU0FBUyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBUzNEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsZ0JBQWdCLENBUzlCLGtCQUFtQztJQUNuQyxPQUFPLElBQUksQ0FDVCxTQUFTLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtRQUNsQixNQUFNLFdBQVcsR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QyxNQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDO1lBQ25ELENBQUMsQ0FBQyxXQUFXO1lBQ2IsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbEIsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUNuQixjQUFjLENBQUMsR0FBRyxrQkFBa0IsQ0FBQyxDQUNyQixDQUFDO0lBQ3JCLENBQUMsQ0FBQyxDQUNILENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgT2JzZXJ2ZWRWYWx1ZU9mLCBvZiwgT3BlcmF0b3JGdW5jdGlvbiwgcGlwZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY29uY2F0TWFwLCB3aXRoTGF0ZXN0RnJvbSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuLy8gVGhlIGFycmF5IG92ZXJsb2FkIGlzIG5lZWRlZCBmaXJzdCBiZWNhdXNlIHdlIHdhbnQgdG8gbWFpbnRhaW4gdGhlIHByb3BlciBvcmRlciBpbiB0aGUgcmVzdWx0aW5nIHR1cGxlXG5leHBvcnQgZnVuY3Rpb24gY29uY2F0TGF0ZXN0RnJvbTxUIGV4dGVuZHMgT2JzZXJ2YWJsZTx1bmtub3duPltdLCBWPihcbiAgb2JzZXJ2YWJsZXNGYWN0b3J5OiAodmFsdWU6IFYpID0+IFsuLi5UXVxuKTogT3BlcmF0b3JGdW5jdGlvbjxWLCBbViwgLi4ueyBbaSBpbiBrZXlvZiBUXTogT2JzZXJ2ZWRWYWx1ZU9mPFRbaV0+IH1dPjtcbmV4cG9ydCBmdW5jdGlvbiBjb25jYXRMYXRlc3RGcm9tPFQgZXh0ZW5kcyBPYnNlcnZhYmxlPHVua25vd24+LCBWPihcbiAgb2JzZXJ2YWJsZUZhY3Rvcnk6ICh2YWx1ZTogVikgPT4gVFxuKTogT3BlcmF0b3JGdW5jdGlvbjxWLCBbViwgT2JzZXJ2ZWRWYWx1ZU9mPFQ+XT47XG4vKipcbiAqICdjb25jYXRMYXRlc3RGcm9tJyBjb21iaW5lcyB0aGUgc291cmNlIHZhbHVlXG4gKiBhbmQgdGhlIGxhc3QgYXZhaWxhYmxlIHZhbHVlIGZyb20gYSBsYXppbHkgZXZhbHVhdGVkIE9ic2VydmFibGVcbiAqIGluIGEgbmV3IGFycmF5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb25jYXRMYXRlc3RGcm9tPFxuICBUIGV4dGVuZHMgT2JzZXJ2YWJsZTx1bmtub3duPltdIHwgT2JzZXJ2YWJsZTx1bmtub3duPixcbiAgVixcbiAgUiA9IFtcbiAgICBWLFxuICAgIC4uLihUIGV4dGVuZHMgT2JzZXJ2YWJsZTx1bmtub3duPltdXG4gICAgICA/IHsgW2kgaW4ga2V5b2YgVF06IE9ic2VydmVkVmFsdWVPZjxUW2ldPiB9XG4gICAgICA6IFtPYnNlcnZlZFZhbHVlT2Y8VD5dKVxuICBdXG4+KG9ic2VydmFibGVzRmFjdG9yeTogKHZhbHVlOiBWKSA9PiBUKTogT3BlcmF0b3JGdW5jdGlvbjxWLCBSPiB7XG4gIHJldHVybiBwaXBlKFxuICAgIGNvbmNhdE1hcCgodmFsdWUpID0+IHtcbiAgICAgIGNvbnN0IG9ic2VydmFibGVzID0gb2JzZXJ2YWJsZXNGYWN0b3J5KHZhbHVlKTtcbiAgICAgIGNvbnN0IG9ic2VydmFibGVzQXNBcnJheSA9IEFycmF5LmlzQXJyYXkob2JzZXJ2YWJsZXMpXG4gICAgICAgID8gb2JzZXJ2YWJsZXNcbiAgICAgICAgOiBbb2JzZXJ2YWJsZXNdO1xuICAgICAgcmV0dXJuIG9mKHZhbHVlKS5waXBlKFxuICAgICAgICB3aXRoTGF0ZXN0RnJvbSguLi5vYnNlcnZhYmxlc0FzQXJyYXkpXG4gICAgICApIGFzIE9ic2VydmFibGU8Uj47XG4gICAgfSlcbiAgKTtcbn1cbiJdfQ==